{% load humanize %}
{% load dict_extras %}
<!DOCTYPE html>
<html lang="es">
<head>
    <title>Presupuestos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        input[type="number"] { min-width: 80px; }
        td, th { vertical-align: middle !important; }
        tfoot { font-weight: bold; background: #f3f3f3; }
    </style>
</head>
<body>
<div class="container mt-4">
<h3>Presupuesto {{ anio }}{% if empresa %} - {{ empresa.nombre }}{% endif %}</h3>
<form method="post">
    {% csrf_token %}
    <div class="table-responsive">
        <table class="table table-bordered table-sm align-middle">
            <thead>
                <tr>
                    <th>Tipo de Gasto</th>
                    {% for mes_nombre in meses_nombres %}
                        <th>{{ mes_nombre }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for tipo in tipos %}
<tr>
    <td>{{ tipo.nombre }}</td>
    {% for mes in meses %}
        <td>
            {% with clave=tipo.id|stringformat:"s"|add:","|add:mes|stringformat:"s" %}
                {% with p=presup_dict|get_tuple:clave %}
                    <input type="number" step="0.01" min="0"
                        name="presupuesto_{{ tipo.id }}_{{ mes }}"
                        class="form-control form-control-sm"
                        value="{% if p %}{{ p.monto|floatformat:2 }}{% else %}0{% endif %}">
                {% endwith %}
            {% endwith %}
        </td>
    {% endfor %}
</tr>
{% endfor %}

            </tbody>
            <tfoot>
                <tr>
                    <td>TOTAL MES</td>
                    {% for mes in meses %}
                        <td>${{ totales_mes|get_item:mes|floatformat:2|intcomma }}</td>
                    {% endfor %}
                </tr>
            </tfoot>
        </table>
    </div>
    <button class="btn btn-success">Guardar cambios</button>
    <a href="{% url 'bienvenida' %}" class="btn btn-secondary">Regresar Men√∫</a>
</form>
</div>
</body>
</html>
