<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Saldos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container mt-2">
    <h2 class="mb-2">Dashboard de Saldos</h2>
    <form method="get" class="row mb-2 g-1">
        {% if empresas %}
        <div class="col-md-2">
            <label>Empresa:</label>
            <select name="empresa" class="form-select">
                {% for empresa in empresas %}
                <option value="{{ empresa.id }}" {% if empresa.id == empresa_id %}selected {% endif %}>{{ empresa.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        <div class="col-md-2">
            <label>Cliente:</label>
            <select name="cliente" class="form-select">
                <option value="">-- Todos --</option>
                {% for cliente in clientes %}
                <option value="{{ cliente.id }}" {% if cliente.id == cliente_id %}selected{% endif %}>{{ cliente.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label>Vigencia:</label>
            <select name="rango" class="form-select">
                <option value="">-- Todas --</option>
                <option value="90+" {% if rango == '90+' %}selected{% endif %}>0-30 Dias</option>
                <option value="61-90" {% if rango == '61-90' %}selected{% endif %}>61-90 días</option>
                <option value="31-60" {% if rango == '31-60' %}selected{% endif %}>31-60 días</option>
                <option value="0-30" {% if rango == '0-30' %}selected{% endif %}>Mas de 90 Dias</option> 
            </select>
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary btn-sm">Aplicar filtros</button>
        </div>
        <div class="mt-2 text-center">
            <a href="{% url 'bienvenida' %}" class="btn btn-secondary"> </a>
            Volver al Menú Principal            
        </div>
        <div class="row mt-4">
    <!-- Gráfico de saldos -->
    <div class="col-md-6">
        <div class="card p-3 shadow rounded-4 text-center">
            <h5 class="mb-2">Saldos por vencimiento</h5>
            <canvas id="chartSaldos" height="240"></canvas>
        </div>
    </div>

    <!-- Gráfico de pagos -->
    <div class="col-md-6">
        <div class="card p-3 shadow rounded-4 text-center">
            <h5 class="mb-2">Distribución de pagos</h5>
            <canvas id="graficoPagos" height="240"></canvas>
        </div>
    </div>
</div>

<!-- Chart 1: Saldos por vencimiento -->
<script>
const ctx = document.getElementById('chartSaldos');
new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: ['0-30 días','31-60 días','61-90 días','90+ días'],
        datasets: [{
            label: 'Saldo pendiente ($)',
            data: [
                {{ saldo_90_mas }},
                {{ saldo_61_90 }},
                {{ saldo_31_60 }},
                {{ saldo_0_30 }}
            ],
            backgroundColor: ['#198754', '#ffc107', '#fd7e14', '#dc3545'],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'left' },
            title: {
                display: true,
                text: 'Distribución de saldos por vencimiento'
            }
        }
    }
});
</script>

<!-- Chart 2: Pagos por origen -->
<script>
const ctxPagos = document.getElementById('graficoPagos').getContext('2d');
new Chart(ctxPagos, {
    type: 'doughnut',
    data: {
        labels: ['Locales', 'Áreas Comunes'],
        datasets: [{
            data: [{{ pagos_locales }}, {{ pagos_areas }}],
            backgroundColor: ['#0d6efd', '#20c997'],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'left' },
            title: {
                display: true,
                text: 'Pagos por origen'
            }
        }
    }
});
</script>
</body>
</html>