{% load humanize %}
{% load custom_filters %}
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Saldos antiguedad </title>
    <!-- Bootstrap base styles -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Font Rubik -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
    <!-- Customised CSS --> 
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <!-- ðŸ”¹ Navbar -->
    {% include 'navbar.html' %}
    
    <div id="loading-overlay" style="display: flex; align-items: center; justify-content: center; position: fixed; z-index: 9999; top:0; left:0; width:100vw; height:100vh; background:rgba(255,255,255,0.8); font-size:2em; color:#333;">
        <div>
            <span class="spinner-border text-primary" role="status"></span>
            Generando reporte...
        </div>
    </div>
<div class="container-fluid mt-4">
    <h2>Reporte Detalle Saldos</h2>
    <a href="{% url 'cartera_vencida_excel' %}" class="btn btn-success mb-3">Exportar a Excel</a>
        <div class="row">
            {% for origen in cartera_vencida %}
                <h5>{{ origen.origen_nombre }} (Total vencido: ${{ origen.total_vencido|floatformat:2|intcomma }})</h5>
            <table border="1" class="table table-striped table-bordered">
                <tr>
                <th>Folio</th>  
                <th>Cliente</th>  
                <th>Monto</th>
                <th>Saldo</th>
                <th>Fecha Vencimiento</th>
                <th>DÃ­as Vencidos</th>
                <th>Concepto</th>
                </tr>
                {% for factura in origen.facturas %}
                <tr>
                <td>{{ factura.folio }}</td>  
                <td>{{ factura.cliente }}</td>
                <td>${{ factura.monto|floatformat:2|intcomma }}</td>
                <td>${{ factura.saldo|floatformat:2|intcomma }}</td>
                <td>{{ factura.fecha_vencimiento|date:"d/b/y"|upper }}</td>
                <td>{{ factura.dias_vencidos }}</td>
                <td>{{ factura.concepto }}</td>
                </tr>
                {% endfor %}
            </table>
            {% empty %}
            <p>No hay cartera vencida.</p>
            {% endfor %}
            </div>
            </div>
<div class="container-fluid mt-4">
<h3 style="color:darkred;">Gran Total Cartera: ${{ total_cartera|floatformat:2|intcomma }}</h3>
</div>
<!-- ðŸ”¹ Footer -->
<footer class="mt-4">
        Â© {% now "Y" %} GESAC. Created By JMEB Todos los derechos reservados. <br>
    </footer>

    <!-- Scripts -->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.addEventListener('load', function() {
            document.getElementById('loading-overlay').style.display = 'none'; 
        });
</script>
</body>
</html>